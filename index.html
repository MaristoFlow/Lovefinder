<!doctype html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8">
  <title>LoveFinder — v3.1</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="LoveFinder — compatibility with A,S,E,C model and safety gate.">
  <style>
    /* ---------- THEME TOKENS ---------- */
    :root{
      /* Dark theme (default) */
      --bg-start:#0d0a1a; --bg-end:#1b1133;
      --ink:#f8f6fb; --muted:#cbb9da; --line:rgba(255,255,255,.12);
      --accent:#ff7dab; --accent-2:#b78bfa; --accent-3:#ffd27d;
      --card-bg:rgba(255,255,255,.06); --card-blur:10px;
      --good:#79f7c7; --mid:#ffd27d; --warn:#ffb487; --low:#ff8a9e;
      --field-bg:rgba(255,255,255,.06); --focus-ring:rgba(255,210,125,.55);
      --pill-bg:rgba(255,255,255,.04);
      --btn-shadow:0 10px 24px rgba(255,125,171,.28);
    }
    [data-theme="light"]{
      --bg-start:#fff7fb; --bg-end:#fff; /* soft ivory */
      --ink:#2b2236; --muted:#6d5b7c; --line:rgba(0,0,0,.12);
      --accent:#e64686; --accent-2:#7b5cff; --accent-3:#f3b300;
      --card-bg:rgba(255,255,255,.82); --card-blur:6px;
      --good:#1f7f62; --mid:#b37500; --warn:#b05a2a; --low:#b03a4f;
      --field-bg:rgba(0,0,0,.03); --focus-ring:rgba(230,70,134,.35);
      --pill-bg:rgba(0,0,0,.04);
      --btn-shadow:0 8px 18px rgba(230,70,134,.25);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 600px at 20% -10%, #2a174e 0%, transparent 60%),
        radial-gradient(1000px 800px at 120% 20%, #432066 0%, transparent 55%),
        linear-gradient(180deg, var(--bg-start), var(--bg-end));
      position:relative; overflow-x:hidden;
    }
    [data-theme="light"] body{
      background:
        radial-gradient(1400px 700px at -10% -10%, #ffe3f0 0%, transparent 55%),
        radial-gradient(1100px 800px at 120% 10%, #efe9ff 0%, transparent 60%),
        linear-gradient(180deg, var(--bg-start), var(--bg-end));
    }

    /* Subtle animated sparkles (on good outcomes) */
    .sparkle{
      pointer-events:none; position:fixed; inset:0;
      background:
        radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,.7), transparent 60%),
        radial-gradient(2px 2px at 30% 80%, rgba(255,255,255,.6), transparent 60%),
        radial-gradient(2px 2px at 70% 30%, rgba(255,218,185,.8), transparent 60%),
        radial-gradient(2px 2px at 85% 60%, rgba(255,192,203,.7), transparent 60%),
        radial-gradient(3px 3px at 50% 50%, rgba(255,255,255,.5), transparent 60%);
      mix-blend-mode:screen; opacity:.0; transition:opacity .8s ease; animation:twinkle 6s linear infinite;
    }
    [data-theme="light"] .sparkle{ mix-blend-mode:normal; }
    @keyframes twinkle{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
    body.celebrate .sparkle{ opacity:.6 }

    header{text-align:center;padding:24px 16px}
    header h1{
      margin:0; font-size:1.8rem; letter-spacing:.3px;
      background:linear-gradient(90deg, var(--accent), var(--accent-2), var(--accent-3));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    header .topbar{margin-top:14px; display:flex; justify-content:center; gap:10px; align-items:center}
    .seg{display:inline-flex; border:1px solid var(--line); border-radius:12px; overflow:hidden; background:var(--field-bg)}
    .seg button{
      background:transparent; color:var(--ink); padding:8px 14px; border:0; cursor:pointer; font-weight:700;
    }
    .seg button.active{ background:var(--accent); color:#fff }
    .small{font-size:.95rem;color:var(--muted)}

    main{max-width:960px;margin:0 auto;padding:16px;display:grid;gap:16px}
    .card{
      background:var(--card-bg); border:1px solid var(--line); border-radius:18px; padding:16px;
      backdrop-filter:blur(var(--card-blur));
      box-shadow:0 10px 30px rgba(0,0,0,.14), inset 0 1px 0 rgba(255,255,255,.06);
    }
    .section-title{margin:.2rem 0 .8rem 0}

    .grid{display:grid;gap:10px}
    .two{grid-template-columns:1fr 1fr}
    @media (max-width:720px){.two{grid-template-columns:1fr}}

    label{font-size:.92rem;color:var(--muted);display:block;margin-bottom:6px}
    select,input[type="number"]{
      width:100%;padding:12px;border-radius:12px;
      border:1px solid var(--line); background:var(--field-bg); color:var(--ink);
      outline:none; transition:box-shadow .2s ease, border-color .2s ease;
    }
    select:focus,input[type="number"]:focus{
      border-color:rgba(0,0,0,.18);
      box-shadow:0 0 0 3px var(--focus-ring);
    }

    .pill{
      display:inline-block;padding:6px 12px;border-radius:999px;
      border:1px solid var(--line); color:var(--muted); font-size:.85rem;
      margin:6px 8px 10px 0; background:var(--pill-bg)
    }

    .score{font-size:2.4rem;font-weight:900;letter-spacing:.5px;text-shadow:0 1px 0 rgba(0,0,0,.15)}
    .match-likely{color:var(--good)}
    .match-match{color:var(--mid)}
    .match-chal{color:var(--warn)}
    .match-unre{color:var(--low)}

    hr{border:0;border-top:1px solid var(--line);margin:16px 0}

    .blurb{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line); border-radius:14px; padding:12px; line-height:1.5;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
    }
    [data-theme="light"] .blurb{
      background:linear-gradient(180deg, rgba(0,0,0,.03), rgba(0,0,0,.01));
    }

    .cta-wrap{display:flex;justify-content:center}
    .cta{
      display:inline-block;min-width:260px;padding:16px 22px;border-radius:14px;font-weight:800;
      border:0; cursor:pointer; font-size:1.05rem; color:#1e0e1b;
      background:linear-gradient(90deg, var(--accent), var(--accent-2), var(--accent-3));
      background-size:200% 100%; box-shadow:var(--btn-shadow);
      transition:transform .08s ease, filter .15s ease, background-position .8s ease;
    }
    .cta:hover{filter:brightness(.97); background-position:100% 0}
    .cta:active{transform:translateY(1px)}

    footer{max-width:960px;margin:0 auto;padding:18px 16px;color:var(--muted);text-align:center;font-size:.9rem}

    :focus{outline:2px solid var(--focus-ring);outline-offset:2px}
  </style>
</head>
<body>
  <div class="sparkle" aria-hidden="true"></div>

  <header>
    <h1>LoveFinder</h1>
    <!-- Theme toggle -->
    <div class="topbar" aria-label="Theme">
      <span class="small">Theme</span>
      <div class="seg" role="tablist" aria-label="Theme toggle">
        <button id="themeDark" class="active" role="tab" aria-selected="true">Dark</button>
        <button id="themeLight" role="tab" aria-selected="false">Light</button>
      </div>
    </div>
  </header>

  <main>
    <!-- YOUR PROFILE -->
    <section class="card" aria-labelledby="you-title">
      <h2 id="you-title" class="section-title">Your Profile</h2>

      <div class="grid two">
        <div>
          <label for="gender">Gender</label>
          <select id="gender">
            <option value="">-- Select --</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other/Unspecified</option>
          </select>
        </div>
        <div>
          <label for="age">Age</label>
          <input id="age" type="number" min="18" max="100" placeholder="e.g. 35" inputmode="numeric">
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="background">Background</label>
          <select id="background">
            <option value="">-- Select --</option>
            <option>Upper</</option>
            <option>Middle</option>
            <option>Lower</option>
          </select>
        </div>
        <div>
          <label for="origin">Lifestyle Origin</label>
          <select id="origin">
            <option value="">-- Select --</option>
            <option>Family-Oriented</option>
            <option>Career-Oriented</option>
          </select>
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="kids">Have children</label>
          <select id="kids">
            <option>None</option>
            <option>Part-time custody</option>
            <option>Full-time custody</option>
          </select>
        </div>
        <div>
          <label for="wantKids">Want children</label>
          <select id="wantKids">
            <option>Yes</option>
            <option>No</option>
            <option>Maybe</option>
            <option>Later</option>
          </select>
        </div>
      </div>

      <div class="grid two" style="margin-top:12px">
        <div><label for="appearance">Appearance</label><select id="appearance"></select></div>
        <div><label for="status">Status</label><select id="status"></select></div>
        <div><label for="confidence">Confidence</label><select id="confidence"></select></div>
        <div><label for="empathy">Empathy</label><select id="empathy"></select></div>
      </div>
    </section>

    <!-- PARTNER PROFILE -->
    <section class="card" aria-labelledby="partner-title">
      <h2 id="partner-title" class="section-title">Desired Partner</h2>

      <div class="grid two">
        <div>
          <label for="pGender">Gender</label>
          <select id="pGender">
            <option value="">-- Select --</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other/Unspecified</option>
          </select>
        </div>
        <div>
          <label for="pAge">Age</label>
          <input id="pAge" type="number" min="18" max="100" placeholder="e.g. 28" inputmode="numeric">
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="pBackground">Background</label>
          <select id="pBackground">
            <option value="">-- Select --</option>
            <option>Upper</option>
            <option>Middle</option>
            <option>Lower</option>
          </select>
        </div>
        <div>
          <label for="pOrigin">Lifestyle Origin</label>
          <select id="pOrigin">
            <option value="">-- Select --</option>
            <option>Family-Oriented</option>
            <option>Career-Oriented</option>
          </select>
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="pKids">Have children</label>
          <select id="pKids">
            <option>None</option>
            <option>Part-time custody</option>
            <option>Full-time custody</option>
          </select>
        </div>
        <div>
          <label for="pWantKids">Want children</label>
          <select id="pWantKids">
            <option>Yes</option>
            <option>No</option>
            <option>Maybe</option>
            <option>Later</option>
          </select>
        </div>
      </div>

      <div class="grid two" style="margin-top:12px">
        <div><label for="pAppearance">Appearance</label><select id="pAppearance"></select></div>
        <div><label for="pStatus">Status</label><select id="pStatus"></select></div>
        <div><label for="pConfidence">Confidence</label><select id="pConfidence"></select></div>
        <div><label for="pEmpathy">Empathy</label><select id="pEmpathy"></select></div>
      </div>
    </section>

    <!-- Calculate -->
    <section class="card" aria-label="Actions">
      <div class="cta-wrap">
        <button id="calcBtn" class="cta">Calculate</button>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="result" class="card" hidden>
      <h2>Result</h2>
      <div>
        <span id="youMeta" class="pill"></span>
        <span id="pMeta" class="pill"></span>
        <hr>
        <div id="matchLevel" class="score"></div>
        <div class="small" id="labelText" style="margin-top:4px"></div>
        <hr>
        <div id="humanCopy" class="blurb"></div>
        <div id="humanCopy2" class="blurb" style="margin-top:8px"></div>
        <hr>
        <div id="adviceWrap" class="blurb"></div>
      </div>
    </section>
  </main>

  <footer></footer>

  <script>
  // ---------- helpers ----------
  function fill10(id){
    const el=document.getElementById(id);
    el.innerHTML = '<option value="">--</option>' + Array.from({length:10},(_,i)=>`<option>${i+1}</option>`).join('');
  }
  ["appearance","status","confidence","empathy","pAppearance","pStatus","pConfidence","pEmpathy"].forEach(fill10);

  const val=(id)=>{const el=document.getElementById(id);return el?String(el.value||"").trim():"";};
  function num(id,min=1,max=10){const s=val(id);const x=parseInt(s,10);if(isNaN(x))return 0;return Math.max(min,Math.min(max,x));}
  const clamp=(n,a,b)=>Math.min(b,Math.max(a,n));

  // ---------- Theme toggle ----------
  const htmlEl = document.documentElement;
  const themeDarkBtn = document.getElementById("themeDark");
  const themeLightBtn = document.getElementById("themeLight");

  function setTheme(mode){
    htmlEl.setAttribute("data-theme", mode);
    if(mode==="dark"){
      themeDarkBtn.classList.add("active"); themeDarkBtn.setAttribute("aria-selected","true");
      themeLightBtn.classList.remove("active"); themeLightBtn.setAttribute("aria-selected","false");
    }else{
      themeLightBtn.classList.add("active"); themeLightBtn.setAttribute("aria-selected","true");
      themeDarkBtn.classList.remove("active"); themeDarkBtn.setAttribute("aria-selected","false");
    }
  }
  themeDarkBtn.addEventListener("click", ()=>setTheme("dark"));
  themeLightBtn.addEventListener("click", ()=>setTheme("light"));

  // ---------- Model (Love-only) ----------
  const WEIGHTS = {
    "Female": { appearance:0.23, status:0.38, empathy:0.12, confidence:0.27 },
    "Male":   { appearance:0.46, status:0.12, empathy:0.22, confidence:0.20 },
    "Other/Unspecified": { appearance:0.30, status:0.25, empathy:0.25, confidence:0.20 }
  };

  function baseAgeCurve(age){
    const midLift = (age>=30 && age<=45) ? 1.05 : 1.0;
    const seniorFall = age>55 ? Math.max(0.75, 1 - (age-55)*0.01) : 1.0;
    return midLift*seniorFall;
  }

  function traitUtility(person, weights){
    const s=(k)=>clamp(person.traits[k],1,10);
    const raw = weights.appearance*s("appearance")
              + weights.status*s("status")
              + weights.empathy*s("empathy")
              + weights.confidence*s("confidence");
    return raw/10;
  }

  function directionalGapMultiplier(evaluatorGender, evalAge, targetAge, targetUtility10){
    const gap = targetAge - evalAge;
    const opener = targetUtility10 >= 9 ? 0.5 : (targetUtility10>=8.5 ? 0.65 : 1.0);
    const abs = Math.abs(gap);
    let mult = 1.0;
    if(evaluatorGender==="Female"){
      if(gap>0){ if(abs<=4) mult=1.08; else if(abs<=12) mult=1.0; else mult=1.0-Math.min(0.35,(abs-12)*0.03); }
      else if(gap<0){ if(abs<=2) mult=0.98; else if(abs<=8) mult=0.9; else mult=1.0-Math.min(0.45,(abs-8)*0.04); }
    } else if(evaluatorGender==="Male"){
      if(gap<0){ if(abs<=8) mult=1.06; else if(abs<=12) mult=1.0; else mult=1.0-Math.min(0.30,(abs-12)*0.025); }
      else if(gap>0){ if(abs<=6) mult=0.98; else if(abs<=12) mult=0.92; else mult=1.0-Math.min(0.40,(abs-12)*0.03); }
    } else {
      if(abs<=12) mult=1.0; else mult=1.0 - Math.min(0.35,(abs-12)*0.025);
    }
    return 1.0 - (1.0 - mult)*opener;
  }

  function sideFit(evaluator, target){
    const w = WEIGHTS[evaluator.gender] || WEIGHTS["Other/Unspecified"];
    const utility = traitUtility(target, w);
    const ageBase = baseAgeCurve(target.age);
    const dir = directionalGapMultiplier(evaluator.gender, evaluator.age, target.age, utility*10);
    return { fit: clamp(utility*ageBase*dir,0,1), utility, ageBase, dir, weights:w };
  }

  function mutualMatch(a,b){
    const left = sideFit(a,b);
    const right= sideFit(b,a);
    const score = Math.round(Math.sqrt(left.fit*right.fit)*100);
    return { score, left, right };
  }

  function labelBand(score){
    if(score>=70) return {band:"Likely", cls:"match-likely"};
    if(score>=60) return {band:"Match", cls:"match-match"};
    if(score>=45) return {band:"Challenging", cls:"match-chal"};
    return {band:"Unrealistic", cls:"match-unre"};
  }

  // ---------- Context (Love-only) ----------
  function contextModifier(you, partner){
    let mod=0;
    const yK=(you.kids||"").toLowerCase(), pK=(partner.kids||"").toLowerCase();
    const yW=(you.wantKids||"").toLowerCase(), pW=(partner.wantKids||"").toLowerCase();

    if((yW==="yes"&&pW==="no")||(yW==="no"&&pW==="yes")) mod+=8;
    if((yW==="yes"&&pW==="later")||(yW==="later"&&pW==="yes")) mod+=3;
    if(yK==="full-time custody" && pK==="none") mod+=2;
    if(pK==="full-time custody" && yK==="none") mod+=2;
    if(yK!=="none" && pK!=="none") mod-=1;

    const yb=(you.background||"").toLowerCase(), pb=(partner.background||"").toLowerCase();
    if(yb && pb){
      if(yb===pb){ mod -= (yb==="upper"?2: yb==="middle"?1:0); }
      else { if((yb==="upper"&&pb==="lower")||(yb==="lower"&&pb==="upper")) mod+=2; else mod+=1; }
    }

    const yo=(you.origin||"").toLowerCase(), po=(partner.origin||"").toLowerCase();
    if(yo && po){ mod += (yo===po? -1 : 1); }

    const gap=Math.abs(you.age-partner.age);
    if(gap>=20) mod+=6; else if(gap>=15) mod+=3; else if(gap>=10) mod+=1;
    return mod;
  }
  function applyContext(score, you, partner){
    const mod = contextModifier(you, partner);
    const damp = Math.max(0.6, 1 - mod*0.02);
    return Math.round(score*damp);
  }

  // ---------- LUDACRIS gate (Love) ----------
  const LUDACRIS = { gapUnder25:30, teenVsOlder:40, extreme70v25:true, delta:12, deltaAge:15 };
  function isLudacris(you, partner){
    const gap = Math.abs(you.age - partner.age);
    const targetUnder25 = partner.age < 25;
    const targetTeen = partner.age <= 19;
    const seeker70plus = you.age >= 70;

    const wantTotal = (partner.traits.appearance + partner.traits.status + partner.traits.empathy + partner.traits.confidence);
    const haveTotal = (you.traits.appearance + you.traits.status + you.traits.empathy + you.traits.confidence);
    const demandDelta = wantTotal - haveTotal;

    if (targetUnder25 && gap >= LUDACRIS.gapUnder25) return true;
    if (targetTeen && you.age >= LUDACRIS.teenVsOlder) return true;
    if (seeker70plus && partner.age <= 25 && LUDACRIS.extreme70v25) return true;
    if (demandDelta >= LUDACRIS.delta && (you.age - partner.age) >= LUDACRIS.deltaAge) return true;
    return false;
  }

  // ---------- IO ----------
  function readPerson(prefix){
    if(prefix==="p"){
      return {
        gender: val("pGender") || "Other/Unspecified",
        age: parseInt(val("pAge"),10) || 0,
        traits: {
          appearance: num("pAppearance")||5,
          status:     num("pStatus")||5,
          empathy:    num("pEmpathy")||5,
          confidence: num("pConfidence")||5,
        },
        background: val("pBackground") || "",
        origin:     val("pOrigin") || "",
        kids:       val("pKids") || "None",
        wantKids:   val("pWantKids") || "Maybe",
      };
    }
    return {
      gender: val("gender") || "Other/Unspecified",
      age: parseInt(val("age"),10) || 0,
      traits: {
        appearance: num("appearance")||5,
        status:     num("status")||5,
        empathy:    num("empathy")||5,
        confidence: num("confidence")||5,
      },
      background: val("background") || "",
      origin:     val("origin") || "",
      kids:       val("kids") || "None",
      wantKids:   val("wantKids") || "Maybe",
    };
  }

  // ---------- Human-language (Love only) ----------
  const WORDS_LOVE = {
    Likely:      ["spark","flow","green light","synergy","aligned","smooth","locked-in","momentum","chemistry","strong fit","solid base","clicking"],
    Match:       ["promising","workable","steady","balanced","real shot","doable","potential","growing","explore","on track","worth it","solid chance"],
    Challenging: ["hurdles","friction","effort","rough edges","obstacles","heavy lift","uphill","bumpy","shaky","tension","patchy","mixed signals"],
    Unrealistic: ["off-track","mismatch","clash","low vibe","unlikely","disconnect","far apart","gap","no flow","hard to click","out of sync","different lanes"]
  };
  const TPL_LOVE = {
    Likely: [
      "The {w1} is obvious and things feel {w2}.",
      "This looks like a {w1}—real {w2} and easy momentum.",
      "You’re {w1} and the vibe is {w2}.",
      "Strong {w1}; connection feels {w2} from the start.",
      "{w1} energy with a {w2} path forward."
    ],
    Match: [
      "Feels {w1}—a {w2} path if you nurture it.",
      "A {w1} setup with {w2} potential.",
      "This is {w1}; give it time and {w2}.",
      "{w1} overall, with a {w2} chance to grow.",
      "A {w1} match that’s {w2} to build on."
    ],
    Challenging: [
      "There are {w1}; expect a {w2} road.",
      "Attraction is there, but {w1} make it {w2}.",
      "Some {w1} ahead—could be {w2} without alignment.",
      "It’s {w1} right now; progress may feel {w2}.",
      "You’ll meet {w1}; keep expectations {w2}."
    ],
    Unrealistic: [
      "The vibe feels {w1}—chemistry is {w2}.",
      "This reads {w1}, with {w2} energy.",
      "You’re {w1}; connection will be {w2}.",
      "{w1} signals here—things may stay {w2}.",
      "Overall {w1}; likely {w2} for now."
    ]
  };
  const WHY_LOVE = {
    Likely:      ["You notice the good stuff fast—keep the pace natural.","Lean into shared energy and simple wins.","Let it breathe; the chemistry is already doing the work."],
    Match:       ["There’s enough here to explore—small dates, real talk.","Focus on easy overlap; don’t over-engineer it.","Keep it steady; curiosity beats intensity."],
    Challenging: ["Name the friction early and keep plans lightweight.","Short, low-stakes hangs help you read it clearly.","If it drains you, step back and reset the tempo."],
    Unrealistic: ["It’s okay to pass—save energy for better fits.","Wish them well and keep your bar where it belongs.","No need to force a vibe that isn’t there."]
  };

  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function humanize(band){
    const words = WORDS_LOVE[band];
    const tpl   = pick(TPL_LOVE[band]);
    let w1 = pick(words), w2 = pick(words);
    for(let i
