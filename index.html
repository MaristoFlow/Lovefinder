<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Lovefinder — v3.1</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Lovefinder — A,S,E,C model with asymmetric age effects and human-readable feedback.">
  <style>
    /* ================= THEME ================= */
    :root{
      /* Dark (Black) */
      --bg-start:#0d0a1a;
      --bg-end:#1b1133;
      --ink:#f8f6fb;
      --muted:#cbb9da;
      --line:rgba(255,255,255,.14);

      --accent:#ff7dab;   /* rose */
      --accent-2:#b78bfa; /* lilac */
      --accent-3:#ffd27d; /* gold */

      --card-bg:rgba(255,255,255,.06);
      --card-blur:10px;

      --good:#79f7c7; --mid:#ffd27d; --warn:#ffb487; --low:#ff8a9e;

      --control-bg:rgba(255,255,255,.06);
      --control-hover:rgba(255,255,255,.12);
      --control-ring:rgba(183,139,250,.28);
      --chip-bg:rgba(255,255,255,.04);
      --chip-ink:#cbb9da;

      --cta-ink:#1e0e1b;
      --cta-shadow:0 10px 24px rgba(255,125,171,.28);
    }
    [data-theme="light"]{
      /* Light (White) */
      --bg-start:#f6f3fb;
      --bg-end:#fffefd;
      --ink:#1b1730;
      --muted:#6e6791;
      --line:rgba(0,0,0,.12);

      --accent:#e8518f; --accent-2:#7b58e3; --accent-3:#f2b648;

      --card-bg:rgba(255,255,255,.86);
      --card-blur:8px;

      --good:#2aa786; --mid:#c58b1a; --warn:#c06a32; --low:#c23c59;

      --control-bg:#ffffff;
      --control-hover:#f1eefb;
      --control-ring:rgba(123,88,227,.28);
      --chip-bg:#f3f0fb;
      --chip-ink:#6e6791;

      --cta-ink:#ffffff;
      --cta-shadow:0 10px 20px rgba(123,88,227,.25);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--ink);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 20% -10%, #2a174e 0%, transparent 60%),
        radial-gradient(1000px 800px at 120% 20%, #432066 0%, transparent 55%),
        linear-gradient(180deg, var(--bg-start), var(--bg-end));
      position:relative; overflow-x:hidden;
    }
    [data-theme="light"] body, [data-theme="light"]{
      background:linear-gradient(180deg, var(--bg-start), var(--bg-end));
    }

    .sparkle{
      pointer-events:none; position:fixed; inset:0;
      background:
        radial-gradient(2px 2px at 10% 20%, rgba(255,255,255,.7), transparent 60%),
        radial-gradient(2px 2px at 30% 80%, rgba(255,255,255,.6), transparent 60%),
        radial-gradient(2px 2px at 70% 30%, rgba(255,218,185,.8), transparent 60%),
        radial-gradient(2px 2px at 85% 60%, rgba(255,192,203,.7), transparent 60%),
        radial-gradient(3px 3px at 50% 50%, rgba(255,255,255,.5), transparent 60%);
      mix-blend-mode:screen; opacity:.0; transition:opacity .8s ease;
      animation:twinkle 6s linear infinite;
    }
    @keyframes twinkle{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
    .celebrate .sparkle{ opacity:.55 }
    [data-theme="light"] .celebrate .sparkle{ opacity:.30 }

    header{text-align:center;padding:26px 16px}
    header h1{
      margin:0; font-size:1.8rem; letter-spacing:.3px;
      background:linear-gradient(90deg, var(--accent), var(--accent-2), var(--accent-3));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    header p{margin:8px 0 0;color:var(--muted)}

    main{max-width:960px;margin:0 auto;padding:16px;display:grid;gap:16px}

    .card{
      background:var(--card-bg); border:1px solid var(--line); border-radius:18px; padding:16px;
      backdrop-filter:blur(var(--card-blur));
      box-shadow:0 10px 30px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.06);
    }
    .section-title{margin:.2rem 0 .8rem 0}

    .grid{display:grid;gap:10px}
    .two{grid-template-columns:1fr 1fr}
    @media (max-width:720px){.two{grid-template-columns:1fr}}

    label{font-size:.92rem;color:var(--muted);display:block;margin-bottom:6px}
    select,input[type="number"]{
      width:100%;padding:12px;border-radius:12px;border:1px solid var(--line);
      background:var(--control-bg); color:var(--ink); outline:none;
      transition:box-shadow .2s ease, border-color .2s ease, background .2s ease;
    }
    select:focus,input[type="number"]:focus{
      border-color:rgba(255,255,255,.28);
      box-shadow:0 0 0 3px var(--control-ring);
    }

    .pill{
      display:inline-block;padding:6px 12px;border-radius:999px;border:1px solid var(--line);
      color:var(--chip-ink); font-size:.85rem; margin:6px 8px 10px 0; background:var(--chip-bg)
    }
    .small{font-size:.95rem;color:var(--muted)}

    .score{font-size:2.4rem;font-weight:900;letter-spacing:.5px;text-shadow:0 1px 0 rgba(0,0,0,.2)}
    .match-likely{color:var(--good)}
    .match-match{color:var(--mid)}
    .match-chal{color:var(--warn)}
    .match-unre{color:var(--low)}
    hr{border:0;border-top:1px solid var(--line);margin:16px 0}

    .blurb{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line); border-radius:14px; padding:12px; line-height:1.5;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
    }

    /* Theme toggle segment */
    .seg{display:inline-flex;border:1px solid var(--line);border-radius:12px;overflow:hidden;background:var(--control-bg)}
    .seg button{background:transparent;color:var(--ink);padding:10px 14px;border:0;cursor:pointer}
    .seg button.active{background:linear-gradient(90deg, var(--accent), var(--accent-2));color:#fff}

    /* Number pickers for classes 1–10 */
    .num-card .legend{color:var(--muted);font-size:.9rem;margin:2px 0 10px}
    .num-grid{display:grid;grid-template-columns:repeat(10, minmax(34px,1fr));gap:6px}
    .num-grid button{
      border:1px solid var(--line); border-radius:10px; padding:8px 0; background:var(--control-bg);
      color:var(--ink); cursor:pointer; transition:transform .05s ease, background .15s ease, border-color .15s ease;
    }
    .num-grid button:hover{background:var(--control-hover)}
    .num-grid button:active{transform:translateY(1px)}
    .num-grid button.active{
      background:linear-gradient(90deg,var(--accent),var(--accent-2),var(--accent-3));
      color:var(--cta-ink); border-color:transparent;
    }

    /* CTA with ready-state color */
    .cta-wrap{display:flex;justify-content:center}
    .cta{
      display:inline-block;min-width:260px;padding:16px 22px;border-radius:14px;font-weight:800;border:0;cursor:pointer;font-size:1.05rem;
      color:var(--cta-ink);
      background:linear-gradient(90deg, var(--accent), var(--accent-2), var(--accent-3));
      background-size:200% 100%; box-shadow:var(--cta-shadow);
      transition:transform .08s ease, filter .15s ease, background-position .8s ease, opacity .2s ease;
      opacity:.55; /* not ready */
    }
    .cta.ready{ opacity:1 }
    .cta:hover{filter:brightness(.97); background-position:100% 0}
    .cta:active{transform:translateY(1px)}

    footer{max-width:960px;margin:0 auto;padding:18px 16px;color:var(--muted);text-align:center;font-size:.9rem}

    /* Accessibility focus */
    :focus{outline:2px solid rgba(123,88,227,.45);outline-offset:2px}
    .visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body data-theme="dark">
  <div class="sparkle" aria-hidden="true"></div>

  <header>
    <h1>Lovefinder</h1>
    <p>Set your profiles, pick class levels, then calculate.</p>
  </header>

  <!-- THEME TOGGLE -->
  <section class="card" aria-label="Theme">
    <div style="display:flex;justify-content:center;align-items:center;gap:12px">
      <span class="small">Background</span>
      <div class="seg" role="tablist" aria-label="Background theme">
        <button id="themeDark" class="active" role="tab" aria-selected="true">Black</button>
        <button id="themeLight" role="tab" aria-selected="false">White</button>
      </div>
    </div>
  </section>

  <main>
    <!-- YOUR PROFILE (bio only, cleaner) -->
    <section class="card" aria-labelledby="you-title">
      <h2 id="you-title" class="section-title">Your Profile</h2>
      <div class="grid two">
        <div>
          <label for="gender">Gender</label>
          <select id="gender">
            <option value="">-- Select --</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other/Unspecified</option>
          </select>
        </div>
        <div>
          <label for="age">Age</label>
          <input id="age" type="number" min="18" max="100" placeholder="e.g. 35" inputmode="numeric">
        </div>
      </div>
      <div class="grid two" style="margin-top:10px">
        <div>
          <label for="background">Background</label>
          <select id="background">
            <option value="">-- Select --</option>
            <option>Upper</option>
            <option>Middle</option>
            <option>Lower</option>
          </select>
        </div>
      </div>
    </section>

    <!-- YOUR CLASSES -->
    <section class="card num-card" aria-labelledby="you-classes-title">
      <h2 id="you-classes-title" class="section-title">Your Classes (1–10)</h2>
      <div class="legend">Tap to set levels.</div>
      <div class="grid two">
        <div>
          <label>Appearance</label>
          <div id="pick-appearance" class="num-grid" data-for="appearance"></div>
          <select id="appearance" class="visually-hidden"></select>
        </div>
        <div>
          <label>Status</label>
          <div id="pick-status" class="num-grid" data-for="status"></div>
          <select id="status" class="visually-hidden"></select>
        </div>
        <div>
          <label>Confidence</label>
          <div id="pick-confidence" class="num-grid" data-for="confidence"></div>
          <select id="confidence" class="visually-hidden"></select>
        </div>
        <div>
          <label>Empathy</label>
          <div id="pick-empathy" class="num-grid" data-for="empathy"></div>
          <select id="empathy" class="visually-hidden"></select>
        </div>
      </div>
    </section>

    <!-- PARTNER PROFILE -->
    <section class="card" aria-labelledby="partner-title">
      <h2 id="partner-title" class="section-title">Desired Partner</h2>
      <div class="grid two">
        <div>
          <label for="pGender">Gender</label>
          <select id="pGender">
            <option value="">-- Select --</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other/Unspecified</option>
          </select>
        </div>
        <div>
          <label for="pAge">Age</label>
          <input id="pAge" type="number" min="18" max="100" placeholder="e.g. 28" inputmode="numeric">
        </div>
      </div>
      <div class="grid two" style="margin-top:10px">
        <div>
          <label for="pBackground">Background</label>
          <select id="pBackground">
            <option value="">-- Select --</option>
            <option>Upper</option>
            <option>Middle</option>
            <option>Lower</option>
          </select>
        </div>
      </div>
    </section>

    <!-- PARTNER CLASSES -->
    <section class="card num-card" aria-labelledby="p-classes-title">
      <h2 id="p-classes-title" class="section-title">Partner Classes (1–10)</h2>
      <div class="legend">Tap to set desired levels.</div>
      <div class="grid two">
        <div>
          <label>Appearance</label>
          <div id="pick-pAppearance" class="num-grid" data-for="pAppearance"></div>
          <select id="pAppearance" class="visually-hidden"></select>
        </div>
        <div>
          <label>Status</label>
          <div id="pick-pStatus" class="num-grid" data-for="pStatus"></div>
          <select id="pStatus" class="visually-hidden"></select>
        </div>
        <div>
          <label>Confidence</label>
          <div id="pick-pConfidence" class="num-grid" data-for="pConfidence"></div>
          <select id="pConfidence" class="visually-hidden"></select>
        </div>
        <div>
          <label>Empathy</label>
          <div id="pick-pEmpathy" class="num-grid" data-for="pEmpathy"></div>
          <select id="pEmpathy" class="visually-hidden"></select>
        </div>
      </div>
    </section>

    <!-- ACTIONS -->
    <section class="card" aria-label="Actions">
      <div class="cta-wrap">
        <button id="calcBtn" class="cta" aria-label="Calculate">Calculate</button>
      </div>
      <div class="small" style="text-align:center;margin-top:8px">Button brightens when all required choices are set.</div>
    </section>

    <!-- RESULTS -->
    <section id="result" class="card" hidden>
      <h2>Result</h2>
      <div>
        <span id="youMeta" class="pill"></span>
        <span id="pMeta" class="pill"></span>
        <hr>
        <div id="matchLevel" class="score"></div>
        <div class="small" id="labelText" style="margin-top:4px"></div>
        <hr>
        <div id="humanCopy" class="blurb"></div>
        <div id="humanCopy2" class="blurb" style="margin-top:8px"></div>
        <hr>
        <div id="adviceWrap" class="blurb"></div>
      </div>
    </section>
  </main>

  <footer>
    v3.1 — Black/White toggle, simplified fields, class pickers, ready-state calculate.
  </footer>

  <script>
  // --------- helpers ----------
  const $ = (id)=>document.getElementById(id);
  const val=(id)=>{const el=$(id);return el?String(el.value||"").trim():"";};
  const clamp=(n,a,b)=>Math.min(b,Math.max(a,n));
  function num(id,min=1,max=10){const s=val(id);const x=parseInt(s,10);if(isNaN(x))return 0;return Math.max(min,Math.min(max,x));}

  // Fill 1..10 into hidden selects
  function fill10(id){
    const el=$(id);
    el.innerHTML = '<option value="">--</option>' + Array.from({length:10},(_,i)=>`<option>${i+1}</option>`).join('');
  }
  ["appearance","status","confidence","empathy","pAppearance","pStatus","pConfidence","pEmpathy"].forEach(fill10);

  // Build number pickers
  function buildPicker(containerId){
    const c=$(containerId);
    const selectId=c.getAttribute("data-for");
    c.innerHTML = Array.from({length:10},(_,i)=>`<button type="button" data-val="${i+1}">${i+1}</button>`).join('');
    c.addEventListener("click",(e)=>{
      const b=e.target.closest("button"); if(!b) return;
      const v=b.getAttribute("data-val");
      // update active state
      c.querySelectorAll("button").forEach(x=>x.classList.toggle("active", x===b));
      // set hidden select
      $(selectId).value = v;
      updateReady();
    });
  }
  ["pick-appearance","pick-status","pick-confidence","pick-empathy",
   "pick-pAppearance","pick-pStatus","pick-pConfidence","pick-pEmpathy"].forEach(buildPicker);

  // --------- THEME TOGGLE ----------
  const themeDarkBtn = $("themeDark");
  const themeLightBtn= $("themeLight");
  function setTheme(mode){
    document.documentElement.setAttribute("data-theme", mode==="light"?"light":"dark");
    themeDarkBtn.classList.toggle("active", mode!=="light");
    themeLightBtn.classList.toggle("active", mode==="light");
    themeDarkBtn.setAttribute("aria-selected", mode!=="light");
    themeLightBtn.setAttribute("aria-selected", mode==="light");
    localStorage.setItem("lovefinder-theme", m
