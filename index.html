<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Attraction Finder — v2.7 (Lean & Human)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Attraction Finder — Love-focused A,S,E,C model with asymmetric age effects and human-readable results.">
  <style>
    :root{
      --bg:#0f1115;--card:#171a21;--ink:#e9edf5;--muted:#aab2c0;--accent:#7aa2ff;--line:#232838;
      --good:#7dffbc;--mid:#ffe28a;--warn:#ffbc7a;--low:#ff9a9a
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    header{text-align:center;padding:22px 16px}
    header h1{margin:0;font-size:1.6rem}
    header p{margin:6px 0 0;color:var(--muted)}
    main{max-width:960px;margin:0 auto;padding:16px;display:grid;gap:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
    .grid{display:grid;gap:10px}
    .two{grid-template-columns:1fr 1fr}
    @media (max-width:720px){.two{grid-template-columns:1fr}}
    label{font-size:.92rem;color:var(--muted);display:block;margin-bottom:6px}
    select,input[type="number"]{
      width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f131b;color:var(--ink)
    }
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{padding:12px 16px;border:0;border-radius:12px;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    button.secondary{background:#0f131b;border:1px solid var(--line);color:var(--ink);font-weight:600}
    button:hover{filter:brightness(.95)}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--line);color:var(--muted);font-size:.85rem;margin:6px 8px 10px 0}
    .small{font-size:.95rem;color:var(--muted)}
    .score{font-size:2.2rem;font-weight:900;letter-spacing:.5px}
    .match-likely{color:var(--good)}
    .match-match{color:var(--mid)}
    .match-chal{color:var(--warn)}
    .match-unre{color:var(--low)}
    hr{border:0;border-top:1px solid var(--line);margin:14px 0}
    .section-title{margin:.2rem 0 .6rem 0}
    .explain{display:grid;gap:10px}
    .blurb{background:#0f131b;border:1px solid var(--line);border-radius:12px;padding:12px;line-height:1.4}
    footer{max-width:960px;margin:0 auto;padding:18px 16px;color:var(--muted);text-align:center;font-size:.9rem}
    :focus{outline:2px solid #81a7ff;outline-offset:2px}
  </style>
</head>
<body>
  <header>
    <h1>Attraction Finder — v2.7</h1>
    <p>Love-focused predictor with simple, human feedback</p>
  </header>

  <main>
    <!-- YOUR PROFILE -->
    <section class="card" aria-labelledby="you-title">
      <h2 id="you-title" class="section-title">Your Profile</h2>

      <div class="grid two">
        <div>
          <label for="gender">Gender</label>
          <select id="gender">
            <option value="">-- Select --</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other/Unspecified</option>
          </select>
        </div>
        <div>
          <label for="age">Age</label>
          <input id="age" type="number" min="18" max="100" placeholder="e.g. 35" inputmode="numeric">
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="background">Background</label>
          <select id="background">
            <option value="">-- Select --</option>
            <option>Upper</option>
            <option>Middle</option>
            <option>Lower</option>
          </select>
        </div>
        <div>
          <label for="origin">Lifestyle Origin</label>
          <select id="origin">
            <option value="">-- Select --</option>
            <option>Family-Oriented</option>
            <option>Career-Oriented</option>
          </select>
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="kids">Have children</label>
          <select id="kids">
            <option>None</option>
            <option>Part-time custody</option>
            <option>Full-time custody</option>
          </select>
        </div>
        <div>
          <label for="wantKids">Want children</label>
          <select id="wantKids">
            <option>Yes</option>
            <option>No</option>
            <option>Maybe</option>
            <option>Later</option>
          </select>
        </div>
      </div>

      <div class="grid two" style="margin-top:12px">
        <div><label for="appearance">Appearance</label><select id="appearance"></select></div>
        <div><label for="status">Status</label><select id="status"></select></div>
        <div><label for="confidence">Confidence</label><select id="confidence"></select></div>
        <div><label for="empathy">Empathy</label><select id="empathy"></select></div>
      </div>
    </section>

    <!-- PARTNER PROFILE -->
    <section class="card" aria-labelledby="partner-title">
      <h2 id="partner-title" class="section-title">Desired Partner</h2>

      <div class="grid two">
        <div>
          <label for="pGender">Gender</label>
          <select id="pGender">
            <option value="">-- Select --</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other/Unspecified</option>
          </select>
        </div>
        <div>
          <label for="pAge">Age</label>
          <input id="pAge" type="number" min="18" max="100" placeholder="e.g. 28" inputmode="numeric">
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="pBackground">Background</label>
          <select id="pBackground">
            <option value="">-- Select --</option>
            <option>Upper</option>
            <option>Middle</option>
            <option>Lower</option>
          </select>
        </div>
        <div>
          <label for="pOrigin">Lifestyle Origin</label>
          <select id="pOrigin">
            <option value="">-- Select --</option>
            <option>Family-Oriented</option>
            <option>Career-Oriented</option>
          </select>
        </div>
      </div>

      <div class="grid two">
        <div>
          <label for="pKids">Have children</label>
          <select id="pKids">
            <option>None</option>
            <option>Part-time custody</option>
            <option>Full-time custody</option>
          </select>
        </div>
        <div>
          <label for="pWantKids">Want children</label>
          <select id="pWantKids">
            <option>Yes</option>
            <option>No</option>
            <option>Maybe</option>
            <option>Later</option>
          </select>
        </div>
      </div>

      <div class="grid two" style="margin-top:12px">
        <div><label for="pAppearance">Appearance</label><select id="pAppearance"></select></div>
        <div><label for="pStatus">Status</label><select id="pStatus"></select></div>
        <div><label for="pConfidence">Confidence</label><select id="pConfidence"></select></div>
        <div><label for="pEmpathy">Empathy</label><select id="pEmpathy"></select></div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button id="calcBtn">Calculate</button>
        <button id="reportBtn" class="secondary" disabled>Download report</button>
        <button id="resetBtn" class="secondary">Reset</button>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="result" class="card" hidden>
      <h2>Result</h2>
      <div>
        <span id="youMeta" class="pill"></span>
        <span id="pMeta" class="pill"></span>
        <hr>
        <div id="matchLevel" class="score"></div>
        <div class="small" id="labelText" style="margin-top:4px"></div>
        <hr>
        <div id="humanCopy" class="blurb"></div>
        <div id="humanCopy2" class="blurb" style="margin-top:8px"></div>
      </div>
    </section>
  </main>

  <footer>
    v2.7 — Love intent only. Human-first language with randomized copy per band.
  </footer>

  <script>
  // ---------- helpers ----------
  function fill10(id){
    const el=document.getElementById(id);
    el.innerHTML = '<option value="">--</option>' + Array.from({length:10},(_,i)=>`<option>${i+1}</option>`).join('');
  }
  ["appearance","status","confidence","empathy","pAppearance","pStatus","pConfidence","pEmpathy"].forEach(fill10);

  const val=(id)=>{const el=document.getElementById(id);return el?String(el.value||"").trim():"";};
  function num(id,min=1,max=10){const s=val(id);const x=parseInt(s,10);if(isNaN(x))return 0;return Math.max(min,Math.min(max,x));}
  const clamp=(n,a,b)=>Math.min(b,Math.max(a,n));

  // ---------- model (Love-only) ----------
  const WEIGHTS = {
    "Female": { appearance:0.23, status:0.38, empathy:0.12, confidence:0.27 },
    "Male":   { appearance:0.46, status:0.12, empathy:0.22, confidence:0.20 },
    "Other/Unspecified": { appearance:0.30, status:0.25, empathy:0.25, confidence:0.20 }
  };
  const INTENT_DELTA = { "Love": { empathy:+0.06, status:+0.02, appearance:-0.04, confidence:-0.04 } };

  function mixWeights(base){
    const delta = INTENT_DELTA["Love"];
    const mixed = {...base};
    for(const k of Object.keys(delta)){ mixed[k] = Math.max(0.05,(mixed[k]??0)+delta[k]); }
    const sum = Object.values(mixed).reduce((a,b)=>a+b,0);
    for(const k of Object.keys(mixed)){ mixed[k] = mixed[k]/sum; }
    return mixed;
  }

  function baseAgeCurve(age){
    const midLift = (age>=30 && age<=45) ? 1.05 : 1.0;
    const seniorFall = age>55 ? Math.max(0.75, 1 - (age-55)*0.01) : 1.0;
    return midLift*seniorFall;
  }

  function traitUtility(person, weights){
    const s=(k)=>clamp(person.traits[k],1,10);
    const raw = weights.appearance*s("appearance")
              + weights.status*s("status")
              + weights.empathy*s("empathy")
              + weights.confidence*s("confidence");
    return raw/10;
  }

  function directionalGapMultiplier(evaluatorGender, evalAge, targetAge, targetUtility10){
    const gap = targetAge - evalAge;
    const opener = targetUtility10 >= 9 ? 0.5 : (targetUtility10>=8.5 ? 0.65 : 1.0);
    const abs = Math.abs(gap);
    let mult = 1.0;
    if(evaluatorGender==="Female"){
      if(gap>0){ if(abs<=4) mult=1.08; else if(abs<=12) mult=1.0; else mult=1.0-Math.min(0.35,(abs-12)*0.03); }
      else if(gap<0){ if(abs<=2) mult=0.98; else if(abs<=8) mult=0.9; else mult=1.0-Math.min(0.45,(abs-8)*0.04); }
    } else if(evaluatorGender==="Male"){
      if(gap<0){ if(abs<=8) mult=1.06; else if(abs<=12) mult=1.0; else mult=1.0-Math.min(0.30,(abs-12)*0.025); }
      else if(gap>0){ if(abs<=6) mult=0.98; else if(abs<=12) mult=0.92; else mult=1.0-Math.min(0.40,(abs-12)*0.03); }
    } else {
      if(abs<=12) mult=1.0; else mult=1.0 - Math.min(0.35,(abs-12)*0.025);
    }
    return 1.0 - (1.0 - mult)*opener;
  }

  function sideFit(evaluator, target){
    const w = mixWeights(WEIGHTS[evaluator.gender]);
    const utility = traitUtility(target, w);
    const ageBase = baseAgeCurve(target.age);
    const dir = directionalGapMultiplier(evaluator.gender, evaluator.age, target.age, utility*10);
    return { fit: clamp(utility*ageBase*dir,0,1), utility, ageBase, dir, weights:w };
  }

  function mutualMatch(a,b){
    const left = sideFit(a,b);
    const right= sideFit(b,a);
    const score = Math.round(Math.sqrt(left.fit*right.fit)*100);
    return { score, left, right };
  }

  function labelBand(score){
    if(score>=70) return {band:"Likely", cls:"match-likely"};
    if(score>=60) return {band:"Match", cls:"match-match"};
    if(score>=45) return {band:"Challenging", cls:"match-chal"};
    return {band:"Unrealistic", cls:"match-unre"};
  }

  // ---------- context modifiers ----------
  function contextModifier(you, partner){
    let mod=0;
    const yK=(you.kids||"").toLowerCase(), pK=(partner.kids||"").toLowerCase();
    const yW=(you.wantKids||"").toLowerCase(), pW=(partner.wantKids||"").toLowerCase();
    if((yW==="yes"&&pW==="no")||(yW==="no"&&pW==="yes")) mod+=8;
    if((yW==="yes"&&pW==="later")||(yW==="later"&&pW==="yes")) mod+=3;
    if(yK==="full-time custody" && pK==="none") mod+=2;
    if(pK==="full-time custody" && yK==="none") mod+=2;
    if(yK!=="none" && pK!=="none") mod-=1;

    const yb=(you.background||"").toLowerCase(), pb=(partner.background||"").toLowerCase();
    if(yb && pb){
      if(yb===pb){ mod -= (yb==="upper"?2: yb==="middle"?1:0); }
      else { if((yb==="upper"&&pb==="lower")||(yb==="lower"&&pb==="upper")) mod+=2; else mod+=1; }
    }
    const yo=(you.origin||"").toLowerCase(), po=(partner.origin||"").toLowerCase();
    if(yo && po){ mod += (yo===po? -1 : 1); }

    const gap=Math.abs(you.age-partner.age);
    if(gap>=20) mod+=6; else if(gap>=15) mod+=3; else if(gap>=10) mod+=1;
    return mod;
  }
  function applyContext(score, you, partner){
    const mod = contextModifier(you, partner);
    const damp = Math.max(0.6, 1 - mod*0.02);
    return Math.round(score*damp);
  }

  // ---------- IO ----------
  function readPerson(prefix){
    if(prefix==="p"){
      return {
        gender: val("pGender") || "Other/Unspecified",
        age: parseInt(val("pAge"),10) || 0,
        traits: {
          appearance: num("pAppearance")||5,
          status:     num("pStatus")||5,
          empathy:    num("pEmpathy")||5,
          confidence: num("pConfidence")||5,
        },
        background: val("pBackground") || "",
        origin:     val("pOrigin") || "",
        kids:       val("pKids") || "None",
        wantKids:   val("pWantKids") || "Maybe",
      };
    }
    return {
      gender: val("gender") || "Other/Unspecified",
      age: parseInt(val("age"),10) || 0,
      traits: {
        appearance: num("appearance")||5,
        status:     num("status")||5,
        empathy:    num("empathy")||5,
        confidence: num("confidence")||5,
      },
      background: val("background") || "",
      origin:     val("origin") || "",
      kids:       val("kids") || "None",
      wantKids:   val("wantKids") || "Maybe",
    };
  }

  // ---------- Human-language generator ----------
  const WORDS = {
    Likely:      ["spark","flow","green light","synergy","aligned","smooth","locked-in","momentum","chemistry","strong fit","solid base","clicking"],
    Match:       ["promising","workable","steady","balanced","real shot","doable","potential","growing","explore","on track","worth it","solid chance"],
    Challenging: ["hurdles","friction","effort","rough edges","obstacles","heavy lift","uphill","bumpy","shaky","tension","patchy","mixed signals"],
    Unrealistic: ["off-track","mismatch","clash","low vibe","unlikely","disconnect","far apart","gap","no flow","hard to click","out of sync","different lanes"]
  };

  const TEMPLATES = {
    Likely: [
      "The {w1} is obvious and things feel {w2}.",
      "This looks like a {w1}—real {w2} and easy momentum.",
      "You’re {w1} and the vibe is {w2}.",
      "Strong {w1}; connection feels {w2} from the start.",
      "{w1} energy with a {w2} path forward."
    ],
    Match: [
      "Feels {w1}—a {w2} path if you nurture it.",
      "A {w1} setup with {w2} potential.",
      "This is {w1}; give it time and {w2}.",
      "{w1} overall, with a {w2} chance to grow.",
      "A {w1} match that’s {w2} to build on."
    ],
    Challenging: [
      "There are {w1}; expect a {w2} road.",
      "Attraction is there, but {w1} make it {w2}.",
      "Some {w1} ahead—could be {w2} without alignment.",
      "It’s {w1} right now; progress may feel {w2}.",
      "You’ll meet {w1}; keep expectations {w2}."
    ],
    Unrealistic: [
      "The vibe feels {w1}—chemistry is {w2}.",
      "This reads {w1}, with {w2} energy.",
      "You’re {w1}; connection will be {w2}.",
      "{w1} signals here—things may stay {w2}.",
      "Overall {w1}; likely {w2} for now."
    ]
  };

  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function humanize(band){
    const words = WORDS[band];
    const tpl   = pick(TEMPLATES[band]);
    let w1 = pick(words), w2 = pick(words);
    // avoid same word twice
    for(let i=0;i<4 && w2===w1;i++) w2 = pick(words);
    // capitalize first letter nicely
    const sentence = tpl.replace("{w1}", w1).replace("{w2}", w2);
    return sentence.charAt(0).toUpperCase() + sentence.slice(1);
  }

  // A second line tailored to *why* (soft, non-mathy cues)
  const WHY = {
    Likely: [
      "You notice the good stuff fast—keep the pace natural.",
      "Lean into shared energy and simple wins.",
      "Let it breathe; the chemistry is already doing the work."
    ],
    Match: [
      "There’s enough here to explore—small dates, real talk.",
      "Focus on easy overlap; don’t over-engineer it.",
      "Keep it steady; curiosity beats intensity."
    ],
    Challenging: [
      "Name the friction early and keep plans lightweight.",
      "Short, low-stakes hangs help you read it clearly.",
      "If it drains you, step back and reset the tempo."
    ],
    Unrealistic: [
      "It’s okay to pass—save energy for better fits.",
      "Wish them well and keep your bar where it belongs.",
      "No need to force a vibe that isn’t there."
    ]
  };

  // ---------- Report ----------
  function makeReport({me, them, res, finalScore, band, line1, line2}){
    const {left,right,score}=res;
    return [
      "Attraction Finder — personal result",
      "Date: "+new Date().toISOString(),
      "Intent: Love",
      "",
      `You (${me.gender}, ${me.age}) vs Them (${them.gender}, ${them.age})`,
      `Final Score: ${finalScore} — ${band}`,
      "",
      line1,
      line2,
      "",
      // Keep technicals minimal but available for power users:
      `Raw mutual score: ${score}`,
      `Your view (internal): utility ${(left.utility*100).toFixed(1)}; age ${Math.round(left.ageBase*100)}%; gap ${Math.round(left.dir*100)}%`,
      `Their view (internal): utility ${(right.utility*100).toFixed(1)}; age ${Math.round(right.ageBase*100)}%; gap ${Math.round(right.dir*100)}%`
    ].join("\n");
  }

  // ---------- wire ----------
  const calcBtn = document.getElementById("calcBtn");
  const reportBtn = document.getElementById("reportBtn");
  const resetBtn = document.getElementById("resetBtn");
  let lastReport = "";

  resetBtn.addEventListener("click", ()=>{
    document.querySelectorAll("select").forEach(s=>s.selectedIndex=0);
    document.querySelectorAll('input[type="number"]').forEach(i=>i.value="");
    document.getElementById("result").hidden = true;
    reportBtn.disabled = true;
    lastReport = "";
  });

  calcBtn.addEventListener("click", ()=>{
    const me   = readPerson("");
    const them = readPerson("p");

    if(!(me.age>=18 && me.age<=100) || !(them.age>=18 && them.age<=100)){
      alert("Ages must be 18–100."); return;
    }

    const res = mutualMatch(me, them);
    let finalScore = applyContext(res.score, me, them);
    finalScore = clamp(finalScore, 0, 100);
    const {band, cls} = labelBand(finalScore);

    // UI header bits
    document.getElementById("youMeta").textContent =
      `${me.gender}, ${me.age} • A${me.traits.appearance}/S${me.traits.status}/E${me.traits.empathy}/C${me.traits.confidence}`;
    document.getElementById("pMeta").textContent =
      `${them.gender}, ${them.age} • A${them.traits.appearance}/S${them.traits.status}/E${them.traits.empathy}/C${them.traits.confidence}`;

    const matchEl = document.getElementById("matchLevel");
    matchEl.className = "score "+cls;
    matchEl.textContent = `${finalScore} / 100`;
    document.getElementById("labelText").textContent = band;

    // Human copy (no numbers)
    const line1 = humanize(band);
    const line2 = pick(WHY[band]);
    document.getElementById("humanCopy").textContent = line1;
    document.getElementById("humanCopy2").textContent = line2;

    document.getElementById("result").hidden = false;

    // Build downloadable report (light technicals included)
    lastReport = makeReport({me, them, res, finalScore, band, line1, line2});
    reportBtn.disabled = false;
  });

  reportBtn.addEventListener("click", ()=>{
    if(!lastReport) return;
    const blob = new Blob([lastReport], {type:"text/plain"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = "attraction-finder-report.txt"; a.click();
    URL.revokeObjectURL(url);
  });

  // ---------- seed defaults ----------
  (function seed(){
    document.getElementById("gender").value = "Male";
    document.getElementById("age").value = "35";
    document.getElementById("background").value = "Middle";
    document.getElementById("origin").value = "Career-Oriented";
    document.getElementById("kids").value = "None";
    document.getElementById("wantKids").value = "Maybe";
    document.getElementById("appearance").value = "6";
    document.getElementById("status").value = "5";
    document.getElementById("empathy").value = "5";
    document.getElementById("confidence").value = "6";

    document.getElementById("pGender").value = "Female";
    document.getElementById("pAge").value = "28";
    document.getElementById("pBackground").value = "Upper";
    document.getElementById("pOrigin").value = "Career-Oriented";
    document.getElementById("pKids").value = "None";
    document.getElementById("pWantKids").value = "Later";
    document.getElementById("pAppearance").value = "8";
    document.getElementById("pStatus").value = "6";
    document.getElementById("pEmpathy").value = "6";
    document.getElementById("pConfidence").value = "6";
  })();
  </script>
</body>
</html>
