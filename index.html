<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Attraction Finder 2.1</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{--bg:#0f1115;--card:#171a21;--ink:#e9edf5;--muted:#aab2c0;--accent:#7aa2ff;--line:#232838}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    header{text-align:center;padding:22px 16px}
    header h1{margin:0;font-size:1.6rem}
    header p{margin:6px 0 0;color:var(--muted)}
    main{max-width:780px;margin:0 auto;padding:16px;display:grid;gap:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
    .grid{display:grid;gap:10px}
    .grid.two{grid-template-columns:1fr 1fr}
    label{font-size:.92rem;color:var(--muted)}
    select,input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0f131b;color:var(--ink)}
    button{padding:12px 18px;border:0;border-radius:12px;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}
    button:hover{filter:brightness(.95)}
    .result{display:none}
    .score{font-size:1.35rem;font-weight:800}
    .match-high{color:#90f9c4}
    .match-med{color:#ffe28a}
    .match-warn{color:#ffbc7a}
    .match-low{color:#ff9a9a}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--line);color:var(--muted);font-size:.85rem;margin-bottom:6px}
    .small{font-size:.95rem;color:var(--muted)}
    hr{border:0;border-top:1px solid var(--line);margin:14px 0}
  </style>
</head>
<body>
  <header>
    <h1>Attraction Finder 2.1</h1>
    <p>Clarity and insight into hidden attraction dynamics</p>
  </header>

  <main>
    <!-- YOUR PROFILE -->
    <section class="card">
      <h2>Your Profile</h2>
      <div class="grid two">
        <div>
          <label>Gender</label>
          <select id="gender">
            <option value="">-- Select --</option>
            <option>Male</option>
            <option>Female</option>
          </select>
        </div>
        <div>
          <label>Age</label>
          <input id="age" type="number" min="18" max="100" placeholder="e.g. 28">
        </div>
      </div>

      <div class="grid two">
        <div>
          <label>Background</label>
          <select id="background">
            <option value="">-- Select --</option>
            <option>Upper</option>
            <option>Middle</option>
            <option>Lower</option>
          </select>
        </div>
        <div>
          <label>Looking for</label>
          <select id="looking">
            <option value="">-- Select --</option>
            <option>Sex</option>
            <option>Relationship</option>
          </select>
        </div>
      </div>

      <div class="grid two">
        <div>
          <label>Lifestyle Origin</label>
          <select id="origin">
            <option value="">-- Select --</option>
            <option>Family-Oriented</option>
            <option>Career-Oriented</option>
          </select>
        </div>
      </div>

      <div class="grid two" style="margin-top:12px">
        <div><label>Appearance</label><select id="appearance"></select></div>
        <div><label>Status</label><select id="status"></select></div>
        <div><label>Confidence</label><select id="confidence"></select></div>
        <div><label>Empathy</label><select id="empathy"></select></div>
      </div>
    </section>

    <!-- PARTNER PROFILE -->
    <section class="card">
      <h2>Desired Partner</h2>
      <div class="grid two">
        <div>
          <label>Gender</label>
          <select id="pGender">
            <option value="">-- Select --</option>
            <option>Male</option>
            <option>Female</option>
          </select>
        </div>
        <div>
          <label>Age</label>
          <input id="pAge" type="number" min="18" max="100" placeholder="e.g. 24">
        </div>
      </div>

      <div class="grid two">
        <div>
          <label>Background</label>
          <select id="pBackground">
            <option value="">-- Select --</option>
            <option>Upper</option>
            <option>Middle</option>
            <option>Lower</option>
          </select>
        </div>
        <div>
          <label>Lifestyle Origin</label>
          <select id="pOrigin">
            <option value="">-- Select --</option>
            <option>Family-Oriented</option>
            <option>Career-Oriented</option>
          </select>
        </div>
      </div>

      <div class="grid two" style="margin-top:12px">
        <div><label>Appearance</label><select id="pAppearance"></select></div>
        <div><label>Status</label><select id="pStatus"></select></div>
        <div><label>Confidence</label><select id="pConfidence"></select></div>
        <div><label>Empathy</label><select id="pEmpathy"></select></div>
      </div>
    </section>

    <button id="calcBtn">Calculate</button>

    <!-- RESULTS -->
    <section id="result" class="card result">
      <h2>Result</h2>
      <div>
        <span id="youMeta" class="pill"></span>
        <span id="pMeta" class="pill"></span>
        <hr>
        <div id="matchLevel" class="score"></div>
        <div class="small" id="randMessage"></div>
        <div class="small" id="diffs"></div>
      </div>
    </section>
  </main>

  <script>
    // Populate stat dropdowns with 1..10
    function fill10(id){
      const el=document.getElementById(id);
      el.innerHTML = '<option value="">--</option>' + Array.from({length:10},(_,i)=>`<option>${i+1}</option>`).join('');
    }
    ["appearance","status","confidence","empathy","pAppearance","pStatus","pConfidence","pEmpathy"].forEach(fill10);

    // Helpers
    const v = id => document.getElementById(id).value.trim();
    const n = id => { const s=v(id); const x=parseInt(s,10); return isNaN(x)?0:Math.max(1,Math.min(10,x)); };
    const clamp01 = x => Math.max(0, Math.min(10, x));

    // Lifestyle Origin (two options)
    function applyLifestyleOrigin(origin, traits){
      const o=(origin||"").toLowerCase();
      let {appearance,status,confidence,empathy}=traits;
      if(o==="career-oriented"){ status+=2; empathy-=1; }
      else if(o==="family-oriented"){ empathy+=2; status-=1; }
      return {appearance,status,confidence,empathy};
    }

    // Individual weights: age, gender, class + empathy 65+, 75+ penalties
    function individualAdjust(raw, other){
      let { gender, age, background, origin } = raw;
      let { appearance, status, confidence, empathy } = raw;

      gender=(gender||"").toLowerCase();
      background=(background||"").toLowerCase();
      const a=parseInt(raw.age,10)||0;
      const oa=parseInt(other.age,10)||0;
      const og=(other.gender||"").toLowerCase();

      // Female
      if(gender==="female"){
        if(a>=18 && a<=25){ appearance+=2; confidence-=2; empathy+=1; }
        if(a>=26 && a<=35){ appearance-=1; empathy+=2; }
        if(a>=36 && a<=45){ appearance-=2; empathy+=2; }
        if(a>=40 && a<=50 && og==="male" && oa>=18 && oa<=25){ appearance+=1; }
        if(a>=51){ appearance-=2; empathy+=1; }
        status -= 1;
        if(a>=60){ status -= 2; }
      }

      // Male
      if(gender==="male"){
        if(a>=25 && a<=35){ appearance+=1; }
        if(a>=45){ appearance-=1; }
        if(a>=18 && a<=35){ confidence+=2; }
        if(a>=50){ confidence-=1; }
        if(a>=30 && a<=45){ status+=2; }
        if(a>=50 && a<=60){ status+=1; }
        if(a>=18 && a<=25){ status-=1; }
      }

      if(a>=65){ empathy+=2; }
      if(a>=75){ appearance-=3; status-=3; confidence-=3; }

      if(background==="upper"){ status+=2; }
      else if(background==="lower"){ status-=2; }

      ({appearance,status,confidence,empathy}=applyLifestyleOrigin(origin,{appearance,status,confidence,empathy}));

      appearance=clamp01(appearance);
      status=clamp01(status);
      confidence=clamp01(confidence);
      empathy=Math.max(0,empathy);

      return {appearance,status,confidence,empathy};
    }

    function totalScore(s){ return s.appearance+s.status+s.confidence+s.empathy; }

    function ageGapPenalty(ya,pa){
      const g=Math.abs(ya-pa);
      if(g>=25) return 10;
      if(g>=20) return 7;
      if(g>=15) return 4;
      if(g>=10) return 2;
      return 0;
    }

    // Compatibility: background (sex-mode novelty vs relationship homogamy), lifestyle origin match, cross-age dynamics, relationship bonuses, age-gap
    function compatibilityModifier(you,partner){
      let mod=0;

      const yb=(you.background||"").toLowerCase(), pb=(partner.background||"").toLowerCase();
      const yl=(you.looking||"").toLowerCase(), pl=(partner.looking||"").toLowerCase();
      const sexMode = (yl==="sex" || pl==="sex") && !(yl==="relationship" && pl==="relationship");

      // Background
      if(yb && pb){
        if(sexMode){
          if(yb !== pb){
            const bothSex = (yl==="sex" && pl==="sex");
            mod -= bothSex ? 3 : 2; // novelty boost
          }
        }else{
          if(yb===pb){
            if(yb==="upper") mod -= 2;
            else if(yb==="middle") mod -= 1;
          }else{
            if(yb==="lower" && pb==="upper") mod += 3;
            if(yb==="upper" && pb==="lower") mod += 2;
            if(yb==="middle" && (pb==="upper"||pb==="lower")) mod += 1;
          }
        }
      }

      // Lifestyle Origin alignment: same = strong bonus
      const yo=(you.origin||"").toLowerCase(), po=(partner.origin||"").toLowerCase();
      if(yo && po && yo===po){ mod -= 3; }

      // Cross dynamics (age/gender perceived mismatches)
      const yg=(you.gender||"").toLowerCase(), pg=(partner.gender||"").toLowerCase();
      const ya=parseInt(you.age,10)||0,        pa=parseInt(partner.age,10)||0;

      if(yg==="male"&&ya>=30&&ya<=40&&pg==="female"&&pa>=20&&pa<=25) mod+=2;
      if(yg==="female"&&ya>=35&&ya<=45&&pg==="male"&&pa>=18&&pa<=25) mod+=2;
      if(yg==="male"&&ya>=18&&ya<=25&&pg==="female"&&pa>=30&&pa<=35) mod+=2;
      if(pg==="male"&&pa>=18&&pa<=25&&yg==="female"&&ya>=30&&ya<=35) mod+=2;

      // Relationship alignment bonuses (both must choose Relationship)
      const bothRel=(yl==="relationship")&&(pl==="relationship");
      if(bothRel){
        if(Math.abs(ya-pa)<=7) mod -= 2;
        if(ya>=35&&ya<=50&&pa>=35&&pa<=50) mod -= 2;
      }

      // Universal age-gap penalty + directional penalties
      mod += ageGapPenalty(ya,pa);
      if(yg==="male" && ya - pa >= 15 && pa < 35) mod += 6;
      if(yg==="female" && ya - pa >= 12 && pa < 30) mod += 5;

      return mod;
    }

    // New bands + messages
    const msgs = {
      matched: [
        "Aligned values, timing, and energy. Green light.",
        "Strong fit. Lean in and keep momentum.",
        "Great match. Focus on connection, not perfection."
      ],
      realistic: [
        "Workable match with some differences to navigate.",
        "Promising if you communicate clearly about expectations.",
        "Realistic path: set boundaries and grow together."
      ],
      challenged: [
        "Realistic with a major challenge. Pick your battles.",
        "One big friction point stands out. Address it early.",
        "Potential exists, but stability may be shaky without effort."
      ],
      severe: [
        "Mismatch is too large right now. Recalibrate or rethink.",
        "Dynamics are pulling apart. Adjust goals before proceeding.",
        "Compatibility is severely limited. Consider a different target."
      ]
    };

    function choose(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    // Determine label from effective gap + context
    function bandFromGapAndOverrule(you, partner, effGap){
      const ya=parseInt(you.age,10)||0, pa=parseInt(partner.age,10)||0;
      const hardGap=Math.abs(ya-pa);
      if(hardGap>=20) return {key:"severe", label:"Impossible/Severe", cls:"match-low", tip:"Age gap over 20 years."};

      const bothRel = (you.looking||"").toLowerCase()==="relationship" &&
                      (partner.looking||"").toLowerCase()==="relationship";
      const originMismatch = (you.origin||"").toLowerCase() !== (partner.origin||"").toLowerCase();
      const backgroundMismatch = (you.background||"").toLowerCase() !== (partner.background||"").toLowerCase();

      if(effGap <= 4)  return {key:"matched", label:"Matched", cls:"match-high", tip:"Strong overall alignment."};

      // Realistic vs Challenged nuance
      if(effGap <= 10){
        if(bothRel && (originMismatch || backgroundMismatch)){
          return {key:"challenged", label:"Challenged", cls:"match-warn", tip:"Realistic with a major challenge."};
        }
        return {key:"realistic", label:"Realistic", cls:"match-med", tip:"Partial alignment; workable with effort."};
      }

      // High gap becomes Severe
      if(effGap > 10) return {key:"severe", label:"Impossible/Severe", cls:"match-low", tip:"Gaps are too large right now."};

      // Fallback
      return {key:"severe", label:"Impossible/Severe", cls:"match-low", tip:"Compatibility is very low."};
    }

    // Biggest gaps (names only)
    function biggestGapNames(a,b){
      return [["Appearance",a.appearance,b.appearance],["Status",a.status,b.status],["Confidence",a.confidence,b.confidence],["Empathy",a.empathy,b.empathy]]
        .map(([k,x,y])=>({k,gap:Math.abs(x-y)})).sort((u,v)=>v.gap-u.gap).slice(0,2).map(d=>d.k);
    }

    // UI
    document.getElementById("calcBtn").addEventListener("click",()=>{
      const you={gender:v("gender"),age:v("age"),background:v("background"),origin:v("origin"),looking:v("looking"),
        appearance:n("appearance"),status:n("status"),confidence:n("confidence"),empathy:n("empathy")};
      const p={gender:v("pGender"),age:v("pAge"),background:v("pBackground"),origin:v("pOrigin"),
        appearance:n("pAppearance"),status:n("pStatus"),confidence:n("pConfidence"),empathy:n("pEmpathy")};

      if(!you.gender||!you.age||!you.looking||!p.gender||!p.age){
        alert("Please fill Gender, Age, and Looking for (you), plus Gender and Age (partner).");
        return;
      }

      const youAdj=individualAdjust(you,p), pAdj=individualAdjust(p,you);

      const baseGap=Math.abs(totalScore(youAdj)-totalScore(pAdj));
      const compMod=compatibilityModifier(you,p);
      const effGap=Math.max(0, baseGap + compMod);

      const band=bandFromGapAndOverrule(you,p,effGap);

      document.getElementById("youMeta").textContent =
        `${you.gender} • ${you.age} • ${you.background||"Background"} • ${you.origin||"Origin"} • ${v("looking")}`;
      document.getElementById("pMeta").textContent   =
        `${p.gender} • ${p.age} • ${p.background||"Background"} • ${p.origin||"Origin"}`;

      const node=document.getElementById("matchLevel");
      node.className=`score ${band.cls}`;
      node.textContent=band.label;

      // randomized message
      document.getElementById("randMessage").textContent = choose(msgs[band.key]);

      // show only names of key differences
      const names = biggestGapNames(youAdj,pAdj);
      document.getElementById("diffs").textContent = names.length
        ? `Key differences to watch: ${names.join(" & ")}.`
        : `No major differences detected.`;

      document.getElementById("result").style.display="block";
      window.scrollTo({ top: document.getElementById("result").offsetTop - 10, behavior:"smooth" });
    });
  </script>
</body>
</html>